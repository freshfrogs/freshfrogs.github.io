<!DOCTYPE html>
<html lang="{{ site.lang | default: "en-US" }}">
    <style>
        body { display: flex; flex-wrap: wrap; }
        img { width: 64px; height: 64px; }
    </style>
    <link rel="icon" href="../assets/logo.png">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/web3/1.7.0-rc.0/web3.min.js"></script>
        <script src="https://unpkg.com/f0js/dist/f0.js"></script>
        <script src="https://ethereum.factoria.app/f0/token_abi.js"></script>
        <script>
            document.addEventListener("DOMContentLoaded", async () => {
                var web3 = new Web3(window.ethereum);
                var CONTRACT_ADDRESS = "0xBE4Bef8735107db540De269FF82c7dE9ef68C51b"
                var collection = new web3.eth.Contract(token_abi, CONTRACT_ADDRESS);
                let userAcc = web3.currentProvider.selectedAddress;
                const f0 = new F0();
                try {
                    await f0.init({
                        web3: web3,
                        contract: CONTRACT_ADDRESS, // 0xBE4Bef8735107db540De269FF82c7dE9ef68C51b MAIN // 0xc2203Ff7B9d1c65c8Cf0F6c776f6CF358af3c524 RINKEBY
                        network: "main"
                    })
                    } catch (e) {
                        alert(e.message)
                }
                collection.defaultAccount = userAcc
                let incomingTokenTransferEvents = await collection.getPastEvents('Transfer', { filter: {'to': userAcc}, fromBlock: 0, toBlock: 'latest'})
                incomingTokenTransferEvents.forEach( (event) => consoleOutput("<img src='"+event.returnValues.tokenId+".png'>"));
                //consoleOutput(event.returnValues.tokenId)
            })
            function consoleOutput(output) {
                newLine = document.createElement("div")
                newLine.innerHTML = output
                document.getElementById("pre").appendChild(newLine)
            }
        </script>
    </head>
    <body id="pre"></body>
</html>
