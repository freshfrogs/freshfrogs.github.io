<!DOCTYPE html>
<html lang="{{ site.lang | default: "en-US" }}">
    <style>
        body { display: flex; flex-wrap: wrap; }
        img { width: 64px; height: 64px; }
    </style>
    <link rel="icon" href="./assets/logo.png">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/web3/1.7.0-rc.0/web3.min.js"></script>
        <script src="https://unpkg.com/f0js/dist/f0.js"></script>
        <script src="https://ethereum.factoria.app/f0/token_abi.js"></script>
        <script>
            document.addEventListener("DOMContentLoaded", async () => {
                var web3 = new Web3(window.ethereum);
                var CONTRACT_ADDRESS = "0xBE4Bef8735107db540De269FF82c7dE9ef68C51b"
                var collection = new web3.eth.Contract(token_abi, CONTRACT_ADDRESS);
                let userAcc = web3.currentProvider.selectedAddress;
                const f0 = new F0();
                try {
                    await f0.init({
                        web3: web3,
                        contract: CONTRACT_ADDRESS, // 0xBE4Bef8735107db540De269FF82c7dE9ef68C51b MAIN // 0xc2203Ff7B9d1c65c8Cf0F6c776f6CF358af3c524 RINKEBY
                        network: "main"
                    })
                    } catch (e) {
                        alert(e.message)
                }
                //
                collection.defaultAccount = userAcc
                const freshFrogs = await collection.methods.balanceOf(userAcc).call()

                for(let i = 0; i < freshFrogs; i++) {
                    const tokenId = await collection.methods.tokenOfOwnerByIndex(userAcc, i).call()
                    consoleOutput('${tokenId}')
                    //let tokenMetadataURI = await contract.methods.tokenURI(tokenId).call()

                    //if (tokenMetadataURI.startsWith("ipfs://")) {
                    //    tokenMetadataURI = `https://ipfs.io/ipfs/${tokenMetadataURI.split("ipfs://")[1]}`
                    //}

                    //const tokenMetadata = await fetch(tokenMetadataURI).then((response) => response.json())

                    //const spacePunkTokenElement = document.getElementById("nft_template").content.cloneNode(true)
                    //spacePunkTokenElement.querySelector("h1").innerText = tokenMetadata["name"]
                    //spacePunkTokenElement.querySelector("a").href = `https://opensea.io/assets/0x45db714f24f5a313569c41683047f1d49e78ba07/${tokenId}`
                    //spacePunkTokenElement.querySelector("img").src = tokenMetadata["image"]
                    //spacePunkTokenElement.querySelector("img").alt = tokenMetadata["description"]

                    //document.getElementById("nfts").append(spacePunkTokenElement)
                }
                //
            })
            function consoleOutput(output) {
                newLine = document.createElement("div")
                newLine.innerHTML = output
                document.getElementById("pre").appendChild(newLine)
            }
        </script>
    </head>
    <body id="pre"></body>
</html>
