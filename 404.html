<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>FreshFrogs â€“ Wallet Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- CSS is at /style.css in the repo root -->
  <link rel="stylesheet" href="style.css" />
  <link
    rel="shortcut icon"
    type="image/x-icon"
    href="https://freshfrogs.github.io/assets/blackWhite.png"
  />
</head>
<body class="layout-4">
  <div class="page">
    <!-- HEADER -->
    <header class="site-header">
      <nav class="nav">
        <!-- Views controlled by site.js -->
        <a href="#" data-view="collection">Collection</a>
        <a href="#" data-view="rarity">Rarity</a>
        <a href="#" data-view="pond">Pond</a>
        <!-- Wallet tab appears AFTER connect, shows shortened address -->
        <a
          href="#"
          data-view="wallet"
          id="wallet-nav-link"
          style="display: none;"
        ></a>
      </nav>
    </header>

    <!-- DASHBOARD HERO -->
    <section class="hero">
      <div class="hero-main">
        <div class="hero-media">
          <img src="https://freshfrogs.github.io/frog/16.png" class="fly" />
          <img src="https://freshfrogs.github.io/frog/678.png" class="fly" />
          <img src="https://freshfrogs.github.io/frog/31.png" class="fly" />
          <img src="https://freshfrogs.github.io/frog/594.png" class="fly" />
        </div>
        <h1 class="hero-title">freshfrogs.github.io</h1>
        <p class="hero-subtitle">
          A collection of 4,040 randomly generated frogs on the Ethereum
          blockchain, that are each unique with thousands of different
          combinations!
          Stake and earn rewards, level up, unlock custom trait animations and
          more! All secondary sales are entitled to a <b>5%</b> royalty.
        </p>
        <div class="hero-actions">
          <button class="btn primary" id="hero-view-collection-btn">
            View Collection
          </button>
          <!-- Normal connect still works if user wants to connect their own wallet -->
          <button class="btn secondary" id="hero-connect-wallet-btn">
            Connect Wallet
          </button>
        </div>
      </div>
    </section>

    <!-- MAIN DASHBOARD LAYOUT -->
    <main class="dashboard-main">
      <!-- Recent Activity (sales / mints) -->
      <section
        class="panel dashboard-section"
        id="recent-activity-panel"
        style="background: transparent; box-shadow: none; padding: 0;"
      >
        <h2>Recent Activity</h2>
        <p class="dashboard-note" id="recent-sales-status">
          Loading recent sales...
        </p>

        <div class="recent_sales" id="recent-sales"></div>

        <button id="load-more-activity" class="btn secondary" type="button">
          Load More
        </button>
      </section>

      <!-- Rarity Rankings -->
      <section
        class="panel dashboard-section"
        id="rarity-panel"
        style="display:none; background: transparent; box-shadow: none; padding: 0;"
      >
        <h2>Rarity Rankings</h2>
        <p class="dashboard-note" id="rarity-status">
          Top ranked Frogs across the collection (lower rank = rarer).
        </p>

        <div id="rarity-grid" class="recent_sales"></div>

        <button id="load-more-rarity" class="btn secondary" type="button">
          Load More
        </button>
      </section>

      <!-- Pond -->
      <section
        class="panel dashboard-section"
        id="pond-panel"
        style="display:none; background: transparent; box-shadow: none; padding: 0;"
      >
        <h2>The Pond</h2>
        <p class="dashboard-note" id="pond-status">
          All Frogs currently staked by the community.
        </p>

        <div id="pond-grid" class="recent_sales"></div>

        <button id="load-more-pond" class="btn secondary" type="button">
          Load More
        </button>
      </section>

      <!-- Owned Frogs (wallet view; stacked vertically) -->
      <section
        class="panel dashboard-section"
        id="owned-panel"
        style="display:none; background: transparent; box-shadow: none; padding: 0;"
      >
        <h2>Owned Frogs</h2>
        <p class="dashboard-note" id="owned-frogs-status">
          These are Frogs currently held in this wallet.
        </p>

        <div id="owned-frogs-grid" class="nft-grid"></div>
      </section>

      <!-- Staked Frogs (wallet view; BELOW owned frogs) -->
      <section
        class="panel dashboard-section"
        id="staked-panel"
        style="display:none; background: transparent; box-shadow: none; padding: 0;"
      >
        <h2>Staked Frogs</h2>
        <p class="dashboard-note" id="staked-frogs-status">
          These Frogs are staked in the FreshFrogs controller.
        </p>

        <div id="staked-frogs-grid" class="nft-grid"></div>
      </section>
    </main>

    <!-- FOOTER -->
    <footer class="site-footer">
      <span class="footer-links" style="color: white;">
        <a href="#">freshfrogs.github.io</a>
      </span>
    </footer>
  </div>

  <!-- Web3 for wallet / staking functions -->
  <script src="https://cdn.jsdelivr.net/npm/web3@1.10.0/dist/web3.min.js"></script>

  <!-- ABIs + legacy staking helpers (used for staking level / progress) -->
  <script src="https://freshfrogs.github.io/assets/collection_abi.js"></script>
  <script src="https://freshfrogs.github.io/assets/controller_abi.js"></script>
  <script src="https://freshfrogs.github.io/assets/ethereum-dapp.js"></script>

  <!-- Rarity rankings (must load before site.js) -->
  <script src="https://freshfrogs.github.io/assets/rarityrankings.js"></script>

  <!-- Main site logic (recent activity, wallet, dashboard, etc.) -->
  <script src="https://freshfrogs.github.io/assets/site.js"></script>

  <!-- 404-specific: use URL wallet + existing wallet functions (READ-ONLY) -->
  <script>
    (function () {
      'use strict';

      function isValidEthAddress(addr) {
        return /^0x[a-fA-F0-9]{40}$/.test(addr);
      }

      // e.g. /0xabc..., /0xabc.../something
      function getWalletFromPath() {
        var raw = window.location.pathname.replace(/^\/+|\/+$/g, '');
        if (!raw) return null;
        var first = raw.split('/')[0];
        if (isValidEthAddress(first)) return first;
        return null;
      }

      document.addEventListener('DOMContentLoaded', async function () {
        var wallet = getWalletFromPath();
        if (!wallet) {
          // No wallet in URL -> behave like normal homepage
          return;
        }

        try {
          // Optional: make sure read-only contracts are available
          if (typeof ffEnsureReadContracts === 'function') {
            try {
              await ffEnsureReadContracts();
            } catch (e) {
              console.warn('[404 wallet] ffEnsureReadContracts failed', e);
            }
          }

          // Do NOT call ffApplyDashboardUpdates here:
          // - We don't want to change the connected wallet UI / nav address.
          // - This page is just a read-only viewer for the URL wallet.

          // Switch to the wallet view layout
          if (typeof ffShowView === 'function') {
            ffShowView('wallet');
          }

          // Render this wallet's frogs in READ-ONLY mode:
          // - No stake / unstake / transfer buttons
          // - Top-left label on cards is controlled by site.js, but
          //   readOnly mode should avoid overriding it for this viewer.
          if (typeof renderOwnedAndStakedFrogs === 'function') {
            try {
              renderOwnedAndStakedFrogs(wallet, { readOnly: true });
            } catch (e) {
              console.warn('[404 wallet] renderOwnedAndStakedFrogs failed', e);
            }
          }
        } catch (err) {
          console.warn('[404 wallet] Failed to init wallet view from URL:', err);
        }
      });
    })();
  </script>
</body>
</html>
