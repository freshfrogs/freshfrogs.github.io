(function(FF){let user=null;function ui(a){const l=document.getElementById('walletLabel'),b=document.getElementById('connectBtn');if(a){l.textContent='Connected: '+FF.shorten(a);l.style.display='';b.textContent='Disconnect'}else{l.style.display='none';b.textContent='Connect Wallet'}}async function connect(){if(location.protocol==='file:'){alert('Open the site over http(s) to enable wallet.');return}const p=window.ethereum;if(!p){alert("No Ethereum provider found. Install/enable MetaMask.");return}try{const acc=await p.request({method:'eth_requestAccounts'});user=acc?.[0]||null;ui(user);if(user){window.FF_clearOwned();window.FF_fetchOwned(user);document.getElementById('stakeStatus').textContent='Connected. Load Owned/Staked below.'}}catch(e){console.warn(e)}}function disconnect(){user=null;ui(null);window.FF_clearOwned();window.FF_clearStaked();document.getElementById('stakeStatus').textContent='Disconnected.'}document.getElementById('connectBtn')?.addEventListener('click',()=>{user?disconnect():connect()});if(window.ethereum){window.ethereum.on?.('accountsChanged',a=>{user=a?.[0]||null;ui(user);if(user){window.FF_clearOwned();window.FF_fetchOwned(user)}else{window.FF_clearOwned();window.FF_clearStaked()}})}window.FF_getUser=()=>user;window.FF_setWalletUI=ui})(window.FF);