(function(FF,C){
  let LIST=null,LOOK=null; let sortBy='rank';
  function setL(a){LIST=a;LOOK=Object.fromEntries(a.map(x=>[String(x.id),Number(x.ranking??x.rank??NaN)]).filter(([,v])=>!Number.isNaN(v)))}
  async function loadFetch(){try{const a=await FF.fetchJSON(C.JSON_PATH);if(!Array.isArray(a))throw 0;setL(a);return true}catch{return false}}
  function sorted(){if(!LIST?.length)return[];const a=[...LIST];if(sortBy==='score')a.sort((x,y)=>Number(y.rarity??y.score??0)-Number(x.rarity??x.score??0));else a.sort((x,y)=>Number(x.ranking??x.rank??1e9)-Number(y.ranking??y.rank??1e9));return a}
  function renderAll(){const ul=document.getElementById('rarityList');if(!ul)return;ul.innerHTML='';const data=sorted();if(!data.length){ul.innerHTML='<li class="list-item"><div class="muted">No data yet</div></li>';return}data.slice(0,100).forEach(it=>{const id=it.id,rank=it.ranking??it.rank??'?',score=(it.rarity??it.score??'').toString();const li=document.createElement('li');li.className='list-item';li.innerHTML=FF.thumb64(`${C.SOURCE_PATH}/frog/${id}.png`,`Frog ${id}`)+`<div><div><b>Frog #${id}</b></div><div class="muted">${score?`Rarity Score: ${score}`:`Rarity Score: N/A`}</div></div><span class="pill">#${rank}</span>`;ul.appendChild(li)});}
  document.getElementById('sortRankBtn')?.addEventListener('click',()=>{sortBy='rank';renderAll()});
  document.getElementById('sortScoreBtn')?.addEventListener('click',()=>{sortBy='score';renderAll()});
  function showPick(){document.getElementById('localLoad').style.display='block'}
  function wire(){const f=document.getElementById('rarityFile'),b=document.getElementById('useLocalBtn');b?.addEventListener('click',()=>{const file=f?.files?.[0];if(!file){alert("Choose assets/freshfrogs_rarity_rankings.json");return}const rd=new FileReader();rd.onload=()=>{try{const arr=JSON.parse(rd.result);if(!Array.isArray(arr))throw 0;setL(arr);renderAll();window.FF_getRankById=id=>LOOK?(LOOK[String(id)]??null):null;document.getElementById('localLoad').style.display='none'}catch{alert("Invalid rarity JSON")}};rd.readAsText(file)})}
  window.FF_loadRarity=async()=>{let ok=false;if(location.protocol!=='file:'){ok=await loadFetch()}if(!ok){showPick();wire()}window.FF_getRankById=id=>LOOK?(LOOK[String(id)]??null):null;renderAll()};
})(window.FF,window.FF_CFG);