<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Fresh Frogs – Frog Stack</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root{
      --bg:#0a0f14;
      --bg2:#0f1820;
      --ink:#e8f6ff;
      --muted:#8aa4b6;
      --accent:#6ee7ff;
      --accent2:#9bffb1;
      --danger:#ff7a7a;
      --card:#0f1b24;
      --line:#1b2a36;
      --pixel: "ui-monospace", "SFMono-Regular", Menlo, Consolas, monospace;
    }
    *{box-sizing:border-box}
    body{
      margin:0; background: radial-gradient(1200px 800px at 50% -20%, #142231 0%, var(--bg) 65%);
      color:var(--ink); font-family: var(--pixel);
      display:grid; place-items:center; min-height:100vh;
    }
    .wrap{width:min(980px, 100vw); padding:16px;}
    .topbar{
      display:flex; gap:12px; align-items:center; justify-content:space-between;
      padding:10px 12px; background:linear-gradient(180deg, #0f1b24, #0b141b);
      border:1px solid var(--line); border-radius:14px; box-shadow:0 8px 30px rgba(0,0,0,.35);
      margin-bottom:12px;
    }
    .title{
      display:flex; align-items:center; gap:10px; font-weight:800; letter-spacing:1px;
      text-transform:uppercase; font-size:14px;
    }
    .dot{width:10px;height:10px;border-radius:3px;background:var(--accent);box-shadow:0 0 12px var(--accent)}
    .stats{display:flex; gap:14px; font-size:12px; color:var(--muted)}
    .stats b{color:var(--ink)}
    .btns{display:flex; gap:8px; align-items:center;}
    button{
      background:#0d1922; color:var(--ink); border:1px solid var(--line);
      padding:8px 10px; border-radius:10px; font-family:var(--pixel); font-size:12px;
      cursor:pointer; transition:.12s transform ease, .12s border-color ease, .12s background ease;
      user-select:none;
    }
    button:hover{transform:translateY(-1px); border-color:#274053; background:#0f1f2a}
    button:active{transform:translateY(1px)}
    .canvas-wrap{
      position:relative; background:linear-gradient(180deg, var(--bg2), var(--bg));
      border:1px solid var(--line); border-radius:16px; overflow:hidden;
      box-shadow:0 12px 40px rgba(0,0,0,.45);
      touch-action:manipulation;
    }
    canvas{display:block; width:100%; height:auto;}
    .overlay{
      position:absolute; inset:0; display:none; place-items:center; background:rgba(3,6,9,.72);
      backdrop-filter: blur(2px);
    }
    .overlay.show{display:grid;}
    .panel{
      background:var(--card); border:1px solid var(--line); border-radius:16px; padding:16px 18px;
      width:min(420px, 92%); text-align:center; box-shadow:0 10px 30px rgba(0,0,0,.5);
    }
    .panel h1{margin:0 0 8px; font-size:18px; letter-spacing:1px; text-transform:uppercase;}
    .panel p{margin:6px 0; color:var(--muted); font-size:12px; line-height:1.45}
    .panel .big{font-size:28px; color:var(--accent2); margin:8px 0 2px; font-weight:900;}
    .kbd{
      display:inline-flex; gap:6px; align-items:center; padding:2px 6px; border-radius:6px;
      border:1px solid var(--line); background:#0c151d; color:var(--ink); font-size:11px;
    }
    .footer-tip{margin-top:10px; font-size:11px; color:var(--muted)}
    .badge{
      position:absolute; top:10px; left:10px; font-size:11px; padding:4px 6px;
      background:#0b151d; border:1px solid var(--line); border-radius:8px; color:var(--muted);
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="topbar">
      <div class="title"><span class="dot"></span> Frog Stack</div>
      <div class="stats">
        Score: <b id="score">0</b>
        Best: <b id="best">0</b>
        Height: <b id="height">0</b>
        Drops: <b id="drops">0</b>
      </div>
      <div class="btns">
        <button id="muteBtn">Sound: ON</button>
        <button id="restartBtn">Restart</button>
      </div>
    </div>

    <div class="canvas-wrap">
      <div class="badge">tap / click / space to drop</div>
      <canvas id="game" width="720" height="960"></canvas>

      <div class="overlay" id="overlay">
        <div class="panel">
          <h1 id="overlayTitle">Frog Stack</h1>
          <div class="big" id="overlayScore">0</div>
          <p id="overlayText">Stack frogs as high as possible. Perfect drops give bonus points.</p>
          <p>
            Controls:
            <span class="kbd">Click / Tap</span>
            <span class="kbd">Space</span>
            <span class="kbd">↓</span>
          </p>
          <div style="margin-top:10px">
            <button id="playBtn">Play</button>
          </div>
          <div class="footer-tip">Pro tip: line up the center for a “perfect” landing.</div>
        </div>
      </div>
    </div>
  </div>

<script>
(() => {
  // ---------------------------
  // Config (tweak as you want)
  // ---------------------------
  const USE_NFT_IMAGES = true;   // set false for pure pixel squares
  const NFT_BASE = "https://freshfrogs.github.io/frog/"; // {id}.png
  const NFT_MIN_ID = 1;
  const NFT_MAX_ID = 4040;

  const CANVAS_W = 720;
  const CANVAS_H = 960;
  const FLOOR_Y = CANVAS_H - 70;

  // SLOWER / BALANCED DROP FEEL
  const GRAVITY = 0.35;
  const DROP_SPEED_CAP = 10;

  const SWAY_SPEED_START = 2.2;
  const SWAY_SPEED_RAMP = 0.015;

  const BASE_SIZE = 110;
  const SIZE_JITTER = 8;

  const PERFECT_TOL = 6; // px center alignment for perfect drop
  const PERFECT_BONUS = 10;

  const FALL_TILT_TOL = 0.62; // how far center can hang over before topples (ratio of width)

  // ---------------------------
  // DOM
  // ---------------------------
  const canvas = document.getElementById("game");
  const ctx = canvas.getContext("2d");

  const scoreEl = document.getElementById("score");
  const bestEl = document.getElementById("best");
  const heightEl = document.getElementById("height");
  const dropsEl = document.getElementById("drops");

  const overlay = document.getElementById("overlay");
  const overlayTitle = document.getElementById("overlayTitle");
  const overlayScore = document.getElementById("overlayScore");
  const overlayText = document.getElementById("overlayText");
  const playBtn = document.getElementById("playBtn");
  const restartBtn = document.getElementById("restartBtn");
  const muteBtn = document.getElementById("muteBtn");

  // ---------------------------
  // Tiny sound (optional)
  // ---------------------------
  let muted = false;
  const beep = (freq=440, dur=0.05, type="square", gain=0.06) => {
    if (muted) return;
    try {
      const ac = new (window.AudioContext || window.webkitAudioContext)();
      const osc = ac.createOscillator();
      const g = ac.createGain();
      osc.type = type; osc.frequency.value = freq;
      g.gain.value = gain;
      osc.connect(g); g.connect(ac.destination);
      osc.start();
      osc.stop(ac.currentTime + dur);
      osc.onended = () => ac.close();
    } catch (e) {}
  };

  // ---------------------------
  // State
  // ---------------------------
  let stack = [];
  let active = null;
  let swayDir = 1;
  let swaySpeed = SWAY_SPEED_START;
  let cameraY = 0;
  let running = false;   // IMPORTANT: start frozen until Play
  let dropping = false;

  let score = 0;
  let drops = 0;
  let best = +localStorage.getItem("frogstack_best") || 0;

  bestEl.textContent = best;

  // image cache
  const imgCache = new Map();
  const loadFrogImage = (id) => {
    if (!USE_NFT_IMAGES) return null;
    if (imgCache.has(id)) return imgCache.get(id);
    const img = new Image();
    img.src = `${NFT_BASE}${id}.png`;
    imgCache.set(id, img);
    return img;
  };

  // ---------------------------
  // Helpers
  // ---------------------------
  const rand = (a,b)=>Math.random()*(b-a)+a;
  const randi = (a,b)=>Math.floor(rand(a,b+1));

  const resetGame = () => {
    stack = [];
    active = null;
    swayDir = 1;
    swaySpeed = SWAY_SPEED_START;
    cameraY = 0;
    score = 0;
    drops = 0;
    running = true;
    dropping = false;

    // base frog platform
    const baseSize = BASE_SIZE + 30;
    const base = makeFrog(
      CANVAS_W/2 - baseSize/2,
      FLOOR_Y - baseSize,
      baseSize,
      0,
      true
    );
    stack.push(base);

    spawnActive();
    syncUI();
  };

  const makeFrog = (x, y, size, vy=0, isBase=false) => {
    const id = randi(NFT_MIN_ID, NFT_MAX_ID);
    return {
      x, y, size, vy,
      id,
      img: loadFrogImage(id),
      isBase,
      landed: isBase,
      wobble: 0,
      tilt: 0,
    };
  };

  const topFrog = () => stack[stack.length-1];

  const spawnActive = () => {
    const size = BASE_SIZE + rand(-SIZE_JITTER, SIZE_JITTER);
    active = makeFrog(
      CANVAS_W/2 - size/2,
      topFrog().y - 180,
      size,
      0,
      false
    );
    swayDir = Math.random() < 0.5 ? -1 : 1;
  };

  const dropActive = () => {
    if (!running || dropping) return;
    dropping = true;
    active.vy = 1.6; // slower start speed
    beep(520, 0.04);
  };

  const intersectsX = (a, b) => {
    const ax1 = a.x, ax2 = a.x + a.size;
    const bx1 = b.x, bx2 = b.x + b.size;
    return Math.min(ax2, bx2) - Math.max(ax1, bx1);
  };

  const centerX = (f) => f.x + f.size/2;

  const landActiveOn = (under) => {
    active.y = under.y - active.size;
    active.vy = 0;
    active.landed = true;
    dropping = false;

    const dx = centerX(active) - centerX(under);
    const overlap = intersectsX(active, under);

    // scoring
    let add = Math.max(1, Math.floor(overlap / 8));
    if (Math.abs(dx) <= PERFECT_TOL) {
      add += PERFECT_BONUS;
      active.wobble = 1.0;
      beep(880, 0.06, "square", 0.08);
    } else {
      beep(660, 0.04);
    }
    score += add;
    drops++;

    // check tilt/fall condition
    const maxHang = under.size * FALL_TILT_TOL;
    if (Math.abs(dx) > maxHang || overlap <= 6) {
      // topples
      active.tilt = dx > 0 ? 1 : -1;
      running = false;
      setTimeout(()=>gameOver(), 380);
      return;
    }

    // store + ramp difficulty
    stack.push(active);
    swaySpeed += SWAY_SPEED_RAMP;

    spawnActive();
    syncUI();
  };

  const gameOver = () => {
    running = false;
    dropping = false;
    if (score > best) {
      best = score;
      localStorage.setItem("frogstack_best", best);
    }
    bestEl.textContent = best;

    overlayTitle.textContent = "Game Over";
    overlayScore.textContent = score;
    overlayText.textContent = `You stacked ${stack.length-1} frogs.`;
    overlay.classList.add("show");
    beep(180, 0.2, "square", 0.1);
  };

  const syncUI = () => {
    scoreEl.textContent = score;
    dropsEl.textContent = drops;
    heightEl.textContent = Math.max(0, stack.length-1);
  };

  // ---------------------------
  // Input
  // ---------------------------
  const onAction = (e) => {
    e.preventDefault();
    if (!overlay.classList.contains("show")) dropActive();
  };

  window.addEventListener("keydown", (e) => {
    if (e.code === "Space" || e.code === "ArrowDown") {
      e.preventDefault();
      if (overlay.classList.contains("show")) return;
      dropActive();
    }
  });

  canvas.addEventListener("pointerdown", onAction, {passive:false});

  playBtn.onclick = () => {
    overlay.classList.remove("show");
    resetGame(); // sets running=true fresh and centered
  };
  restartBtn.onclick = () => {
    overlay.classList.remove("show");
    resetGame();
  };
  muteBtn.onclick = () => {
    muted = !muted;
    muteBtn.textContent = `Sound: ${muted ? "OFF" : "ON"}`;
  };

  // ---------------------------
  // Camera + Drawing
  // ---------------------------
  function updateCamera() {
    const target = active || (stack.length ? stack[stack.length - 1] : null);
    if (!target) return;

    const desired = Math.min(0, CANVAS_H * 0.4 - (target.y - cameraY));
    cameraY += (desired - cameraY) * 0.08;
  }

  const drawBackground = () => {
    ctx.fillStyle = "#05080b";
    ctx.fillRect(0,0,CANVAS_W,CANVAS_H);

    for (let i=0;i<40;i++){
      const x = (i*97)%CANVAS_W;
      const y = (i*151)%CANVAS_H;
      ctx.fillStyle = i%3===0 ? "#0e2430" : "#0a1820";
      ctx.fillRect(x, y, 2,2);
    }

    ctx.fillStyle = "#071018";
    ctx.fillRect(0, FLOOR_Y, CANVAS_W, CANVAS_H - FLOOR_Y);

    ctx.fillStyle = "#122635";
    ctx.fillRect(0, FLOOR_Y-2, CANVAS_W, 2);
  };

  const drawFrog = (f) => {
    const x = f.x;
    const y = f.y - cameraY;
    const s = f.size;

    ctx.fillStyle = "rgba(0,0,0,0.35)";
    ctx.fillRect(x+6, y+s-6, s-12, 8);

    if (USE_NFT_IMAGES && f.img && f.img.complete) {
      ctx.imageSmoothingEnabled = false;
      ctx.drawImage(f.img, x, y, s, s);
    } else {
      ctx.fillStyle = f.isBase ? "#214a3b" : "#2b845a";
      ctx.fillRect(x, y, s, s);
      ctx.fillStyle = "#0b1c14";
      ctx.fillRect(x+6, y+6, s-12, s-12);
      ctx.fillStyle = "#9bffb1";
      ctx.fillRect(x+14, y+14, 8,8);
      ctx.fillRect(x+s-22, y+14, 8,8);
    }

    if (f.wobble > 0.01) {
      ctx.strokeStyle = "rgba(155,255,177,0.7)";
      ctx.lineWidth = 2;
      ctx.strokeRect(x-2, y-2, s+4, s+4);
    }
  };

  const drawActiveGuide = () => {
    if (!active) return;
    const under = topFrog();
    const y = under.y - active.size - cameraY;
    ctx.fillStyle = "rgba(110,231,255,0.08)";
    ctx.fillRect(under.x, y, under.size, active.size);
  };

  // ---------------------------
  // Update Loop
  // ---------------------------
  const step = () => {
    requestAnimationFrame(step);

    drawBackground();
    updateCamera();

    if (active) {
      if (!dropping) {
        // only sway when game is running
        if (running) {
          active.x += swayDir * swaySpeed;
          if (active.x < 10 || active.x + active.size > CANVAS_W-10) swayDir *= -1;
        } else {
          // keep centered behind overlay
          active.x = CANVAS_W/2 - active.size/2;
        }
        active.y = topFrog().y - 180;
      } else {
        active.vy = Math.min(DROP_SPEED_CAP, active.vy + GRAVITY);
        active.y += active.vy;

        const under = topFrog();
        if (active.y + active.size >= under.y) {
          landActiveOn(under);
        }

        if (active.y - cameraY > CANVAS_H + 120) {
          running = false;
          gameOver();
        }
      }
    }

    for (const f of stack) {
      if (f.wobble > 0) f.wobble *= 0.92;
    }

    drawActiveGuide();
    for (const f of stack) drawFrog(f);
    if (active) drawFrog(active);
  };

  // ---------------------------
  // Start screen
  // ---------------------------
  resetGame();     // create base + active frog
  running = false; // freeze sway until Play

  overlay.classList.add("show");
  overlayTitle.textContent = "Frog Stack";
  overlayScore.textContent = "";
  overlayText.textContent = "Drop frogs and stack them as high as possible.";
  requestAnimationFrame(step);

})();
</script>
</body>
</html>
