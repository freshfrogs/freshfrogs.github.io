<!DOCTYPE html>
<style>
  html{
    background-image: url("/assets/background.png");
  }
  html,h1,h2,h3 {
    font-family: apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji" !important;
  }
  body {
    margin-left: auto;
    margin-right: auto;
    margin-top: auto;
    margin-left: bottom;
    background-color: transparent !important;
  }
  .banner_div {
    overflow: hidden;
    border-radius: 5px;
    margin-left: auto;
    margin-right: auto;
    margin-top: auto;
    margin-bottom: auto;
    width: fit-content;
    height: fit-content;
  }
</style>
<html lang="{{ site.lang | default: "en-US" }}">
  <link rel="icon" href="../assets/logo.png">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="{{ "../assets/css/style.css?v=" | append: site.github.build_revision | relative_url }}">
    <!--[if lt IE 9]>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.min.js"></script>
    <![endif]-->
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/web3/1.7.0-rc.0/web3.min.js"></script>
    <script src="https://ethereum.factoria.app/f0/token_abi.js"></script>
    <script src="https://unpkg.com/f0js/dist/f0.js"></script>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-6PB0WKB4SH"></script>
    <script>
      // <-- [Google Analytics]
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-6PB0WKB4SH');
      // -- >

      var user_address, userInviteList, userInviteKeys, ownedFrogs, contractName, contractSymbol, nextId, nextIdC, collection, COLLECTION, traits_list;
      var CONTRACT_ADDRESS = "0xBE4Bef8735107db540De269FF82c7dE9ef68C51b";
      var NETWORK = "main";
      var morph = sub_frog = base_frog = false;

      document.addEventListener("DOMContentLoaded", async () => {

        const web3 = new Web3(window.ethereum);
        const f0 = new F0();

        COLLECTION = collection = new web3.eth.Contract(token_abi, CONTRACT_ADDRESS);

        try { // Connect Wallet, Factoria

          await f0.init({
            web3: web3,
            contract: CONTRACT_ADDRESS,
            network: NETWORK
          })

          user_address = await web3.currentProvider.selectedAddress;
          userInviteList = await f0.myInvites();
          userInviteKeys = Object.keys(userInviteList);
          ownedFrogs = await collection.methods.balanceOf(user_address).call();
          contractName = await f0.api.name().call();
          contractSymbol = await f0.api.symbol().call();
          nextId = await f0.api.nextId().call();
          nextIdC = parseInt(nextId);

          fetch_user_tokens();

        } catch (e) { console.log(e.message); }

      })

      function consoleOutput(output) {
        document.getElementById("pre").innerHTML = output
      }

      function load_trait(trait, attribute, where) {
        newAttribute = document.createElement("img")
        newAttribute.href = "https://opensea.io/collection/fresh-frogs?search[sortAscending]=true&search[sortBy]=PRICE&search[stringTraits][0][name]="+trait+"&search[stringTraits][0][values][0]="+attribute
        newAttribute.id = attribute
        newAttribute.target = "_blank"
        if (where == 'frogContainer4') {
          newAttribute.className = "frogImg4" //shadesAnimation
        } else {
          newAttribute.className = "frogImg2" //shadesAnimation
        }
        
        newAttribute.style.cursor = "pointer"
        if (attribute === "smoking" || attribute === "smokingPipe" || attribute === "smokingCigar") { 
          newAttribute.src = "https://freshfrogs.io/the-pond/"+trait+"/"+attribute+"2.gif"
        } else if (attribute === "tongueFly") { 
          newAttribute.src = "https://freshfrogs.io/the-pond/"+trait+"/"+attribute+".gif"
        } else if (attribute === "cyan_tongueFly") { 
          newAttribute.src = "https://freshfrogs.io/the-pond/"+trait+"/"+attribute+".gif"
        } else if (attribute === "morphAnimation") {
          newAttribute.src = "https://freshfrogs.io/the-pond/Frog/loadMorph.gif"
        } else if (attribute === "shadesAnimation") {
          newAttribute.src = "https://freshfrogs.io/the-pond/Eyes/shadesAnimation.gif"
        } else if (attribute.includes("croaking2")) {
          console.log('! '+trait+' / '+attribute)
          newAttribute.src = "https://freshfrogs.io/the-pond/"+trait+"/"+attribute+".gif"
        } else {
          newAttribute.src = "https://freshfrogs.io/the-pond/"+trait+"/"+attribute+".png"
        }
        newAttribute.alt = attribute
        document.getElementById(where).appendChild(newAttribute)
      }

      // Select Frog
      async function display_token(token){

        display_frog = 'https://freshfrogs.io/frog/'+token+'.png'
        display_name = 'Frog #'+token
        display_os = ''

        document.getElementById('thisheader').style.backgroundImage = 'url('+display_frog+')';
        document.getElementById('thisheader').style.backgroundSize = "2048px 2048px";

        document.getElementById('previewImg').setAttribute('src', display_frog)
        document.getElementById('display_name').innerHTML = display_name

        openSeaLink = 'https://opensea.io/assets/0xbe4bef8735107db540de269ff82c7de9ef68c51b/'+token
        etherscanLink = 'https://etherscan.io/nft/0xbe4bef8735107db540de269ff82c7de9ef68c51b/'+token

        document.getElementById('selectSub').setAttribute('href', openSeaLink)
        document.getElementById('selectBase').removeAttribute('href');
        document.getElementById('selectBase').innerHTML = '<strong>Morph</strong><frog id="baseText">combinations</frog>'
        document.getElementById('selectBase').onclick = function() {
          if (!morph) {
            base_frog = token
            morph = true;
            document.getElementById('baseText').innerHTML = 'select frog!'
          } else if (morph) {
            alert('Create new custom Frog on Ethereum! Coming soon!')
            console.log('Frog Morph')
            console.log('Frog #'+base_frog)
            console.log('Frog #'+sub_frog)
          } 

        }

      }

      // create blank div

      // Check owned tokens

      function fetch_user_tokens() {

        const options = {method: 'GET', headers: {'X-API-KEY': '1b80881e422a49d393113ede33c81211'}};

        fetch('https://api.opensea.io/api/v1/collection/fresh-frogs', options)
        .then(collection => collection.json())
        .then(collection => {

            var { collection: { banner_image_url, created_date, description, dev_seller_fee_basis_points, external_url, featured_image_url, name, payout_address, traits, stats: { floor_price, market_cap, total_volume, count, num_owners } } } = collection

            traits_list = traits;

        })
        .catch(e => {

            console.log('Error: Could not get Collection data from Opensea.');
            console.error('Error : ' + e.message)
      
        }); // End data pull / first paid Frog 3,236

        fetch('https://api.opensea.io/api/v1/assets?owner='+user_address+'&order_direction=desc&asset_contract_address=0xBE4Bef8735107db540De269FF82c7dE9ef68C51b&limit=7&include_orders=false', options)
        .then((tokens) => tokens.json())
        .then((tokens) => {

          //consoleOutput('<br>'+'<strong>Connected!</strong> <acc style="color: #333 !important;">[ '+truncateAddress(user_address)+' ]</acc><br>'+'[ '+ownedFrogs+' ] Frogs belong to this wallet!<br>'+'<div id="display_frog"></div><hr>')

          var { assets } = tokens
          assets.forEach((frog) => { // console.log(frog)


            var { name, token_metadata, permalink, traits, external_link, token_id } = frog

            let frog_token = document.createElement('div');
            //frog_token.className = 'frog_token';
            frog_token.id = name
            document.getElementById('banner_div').appendChild(frog_token);

            fetch(token_metadata)
            .then((metadata) => metadata.json())
            .then((metadata) => { 

              for (var i = 0; i < metadata.attributes.length; i++) {

                var data = metadata.attributes[i]
                load_trait(data.trait_type, data.value, name)

              }
              
            });

          })

        })
        .catch(e => {

          console.log(e.message);
          console.log('Error: OpenSea Error! fetch_user_tokens()');
      
        })
      }

      function truncateAddress(address) {
        if (!address) {
          return "";
        }
        return `${address.substr(0, 5)}...${address.substr(
          address.length - 5,
          address.length
        )}`;
      }

    </script>
  </head>
  <body>
    <div id="banner_div" class="banner_div"><img src="https://freshfrogs.io/assets/frogs/banner_blank.png" class="banner_blank"/></div>
    <script src="{{ "/assets/js/scale.fix.js" | relative_url }}"></script>
  </body>
</html>
