<link href='https://fonts.googleapis.com/css?family=Poppins' rel='stylesheet'>
<style>
    html {
        font-family: Poppins, sans-serif;
        font-size: small;
        background-image: url("../assets/background.png");
    }
    body {
        margin-left: auto;
        margin-right: auto;
        width: 80%;
        background: white;
        border-radius: 5px;
        padding: 2%;
    }
    .minting-display {
        float: right;
        margin: 5%;
        margin-right: 10%;
        margin-left: 10%;
    }
    .minting-console {
        margin: 2%;
        font-size: x-small;
    }
    .mintingTray {
        text-align: center;
        vertical-align: center;
        height: auto;
        border-radius: 5px;
        border: solid 1px lightgrey;
        overflow: hidden;
        transition: box-shadow .2s;
        width: 256px;
    }
    .mintingTray:hover {
        box-shadow: 0px 0px 6px 6px rgba(122, 122, 122, 0.20);
    }
    .button {
        padding: 16px;
        border: 1px solid lightgray;
        border-radius: 5px;
        background-color: white;
        color: inherit;
        margin-top: 0px;
        margin-left: auto;
        margin-right: auto;
        width: 256px;
        transition: box-shadow .2s;
        cursor: pointer;
    }
    .button:hover {
        box-shadow: 0px 0px 6px 6px rgba(122, 122, 122, 0.20);
    }
    .data {
        margin: auto;
        border-radius: 5px;
    }
    .recent_sales {
        text-align: center;
        display: inline-flex;
        flex-wrap: wrap;
        image-rendering: pixelated;
        margin-left: auto;
        margin-right: auto;
        width: 100%;
    }
    .recent_sale {
        text-align: center;
        vertical-align: center;
        width: 100%;
        height: 100%;
        margin: 0.5%;
        border-radius: 5px;
        border: solid 1px lightgrey;
        overflow: hidden;
        transition: box-shadow .2s;
    }
    .recent_sale:hover{
        box-shadow: 0px 0px 6px 6px rgba(122, 122, 122, 0.20);
    }
    #banner_image {
        width: 100%;
        object-fit: contain;
        border-radius: 5px;
    }
    .frog_name {
        text-align: left;
        font-weight: bold;
        float: left;
        padding: 5%;
        padding-top: 0%;
        margin-left: 2.5%;
    }
    .frog_price {
        text-align: right;
        font-weight: bold;
        float: right;
        padding: 5%;
        padding-top: 0%;
        margin-right: 2.5%;
    }
    .frog_img {
        width: 100%;
        border-radius: 0px;
    }
    .label_name {
        text-align: left;
        float: left;
        margin-left: 2.5%;
        padding: 5%;
        padding-bottom: 0%;
        color: gray;
    }
    .label_price {
        text-align: right;
        float: right;
        margin-right: 2.5%;
        padding: 5%;
        padding-bottom: 0%;
        color: gray;
    }

    .frog_mint {
        text-align: left;
        font-weight: bold;
        float: left;
        padding: 0%;
        margin-left: 2.5%;
        overflow: hidden;
    }
    .frog_q {
        text-align: right;
        font-weight: bold;
        float: right;
        padding: 0%;
        margin-right: 2.5%;
        overflow: hidden;
    }
    .label_mint {
        text-align: left;
        float: left;
        margin-left: 2.5%;
        padding: 0%;
        padding-bottom: 0%;
        color: gray;
        overflow: hidden;
    }
    .label_q {
        text-align: right;
        float: right;
        margin-right: 2.5%;
        padding: 0%;
        padding-bottom: 0%;
        color: gray;
        width: 45%;
        overflow: hidden;
    }
    .frog-tray {
        width: 256px;
        height: 256px;
    }
    .collection-name {
        font-weight: 600;
    }

    #add-frog {
        cursor: pointer;
    }
    .tray-frog {
        width: 100%;
    }
    .owned_frog {
        text-align: center;
        vertical-align: center;
        width: 100%;
        height: 100%;
        margin: 0.5%;
        border-radius: 5px;
        border: solid 1px lightgrey;
        overflow: hidden;
        transition: box-shadow .2s;
        cursor: pointer;
    }
    .owned_frog:hover{
        box-shadow: 0px 0px 6px 6px rgba(122, 122, 122, 0.20);
    }
    .owned_frogs {
        text-align: center;
        display: inline-flex;
        flex-wrap: wrap;
        image-rendering: pixelated;
        margin-left: auto;
        margin-right: auto;
        width: 63%;
        height: 25%;
        border-radius: 5px;
        background-color: whitesmoke;
        border: 1px solid lightgray;
    }
    #display-desc {
        width: 90%;
        padding: 5%;
    }
    #display-id {
        width: 90%;
        padding: 5%;
    }
    .frog_trait {
        text-align: center;
        border: 1px solid #7cc1ff;
        border-radius: 5px;
        width: auto;
        height: auto;
        padding: 2%;
        margin: 1%;
        display: inline-block;
    }
    .lower_display {
        margin-top: 16px;
        width: 256px;
        text-align: center;
        min-height: 128px;
    }
</style>
<html>
    <head>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/web3/1.7.0-rc.0/web3.min.js"></script>
        <script>

            async function load_ownedFrogs() {

                const options = {
                    method: 'GET',
                    headers: {Accept: 'application/json', 'X-API-KEY': '1b80881e422a49d393113ede33c81211'}
                };

                var owned_frogs_div = document.getElementById('owned-frogs')
                
                owned_frogs_div.innerHTML = ''

                owned_frogs_div.style.background = 'white'
                owned_frogs_div.style.border = 'none'

                fetch('https://api.opensea.io/api/v1/assets?owner='+window.userAddress+'&order_direction=asc&asset_contract_address=0xBE4Bef8735107db540De269FF82c7dE9ef68C51b&limit=9&include_orders=false', options)
                .then((res) => res.json())
                .then((res) => {
                    var { assets } = res
                    console.log(assets);
                    assets.forEach((frog) => { // For Each FROG

                        try {

                            var { name, token_metadata, permalink, traits, external_link, token_id } = frog

                            owned_frog = document.createElement('a');
                            owned_frog.id = name
                            owned_frog.className = 'owned_frog';
                            owned_frog.style.width = 128+'px';
                            owned_frog.onclick = function() { 
                                
                                var this_frog = event.currentTarget.id.replace('Frog #', '');
                                
                                document.getElementById('display-frog').setAttribute('src', '../frog/'+this_frog+'.png')

                                document.getElementById('label_name').innerHTML = 'Fresh Frogs NFT'

                                document.getElementById('frog_name').innerHTML = name

                                document.getElementById('label_price').innerHTML = 'Owner'

                                document.getElementById('frog_price').innerHTML = '(You)'

                                etherscan_link = 'https://etherscan.io/nft/0xbe4bef8735107db540de269ff82c7de9ef68c51b/'+token_id
                                gem_xyz_link = 'https://www.gem.xyz/asset/0xbe4bef8735107db540de269ff82c7de9ef68c51b/'+token_id

                                document.getElementById('lower_display').innerHTML = 

                                    '<h4 style="text-align: left;">Details</h4><hr>' +

                                    '<i><a href="'+permalink+'" target="_blank">opensea.io</a></i> ' +' | '+ ' <i>etherscan.io</i> '  +' | '+ ' <i>gem.xyz</i> ' +
                                    
                                    '<h4 style="text-align: left;">Properties</h4><hr>';

                                traits.forEach((trait) => {

                                    //console.log(trait)

                                    var { trait_type, value, trait_count } = trait

                                    var trait_rarity = ((trait_count / 4040) * 100).toFixed(0)

                                    var new_trait = document.createElement('div')
                                    new_trait.className = 'frog_trait'
                                    new_trait.innerHTML = 
                                        
                                        '<i>'+trait_type+'</i><br>' +
                                        '<b>'+value.slice(0, 13)+'</b><br>' +
                                        '<i>'+trait_rarity+'% have this trait<i>';

                                    document.getElementById('lower_display').appendChild(new_trait)

                                })      
                            
                            }
                            owned_frog.innerHTML = 
                                '<img class="frog_img" src='+external_link+'>' +
                                '<i class="label_name">Fresh Frogs NFT</i>' +
                                '<b class="frog_name">'+name+'</b>';
                            document.getElementById('owned-frogs').appendChild(owned_frog);
                        
                        } catch (e) { console.log(e.message) }
                    })
                })
                .catch(e => {
                    document.getElementById('owned-frogs').innerHTML = e.message
                    console.log(e.message)
                })

                document.getElementById('owned-frogs').style.height = 'auto';

            }

            function truncateAddress(address) {
                if (!address) {
                    return "";
                }
                return `${address.substr(0, 5)}...${address.substr(
                    address.length - 5,
                    address.length
                )}`;
            }
            // Login with Web3 via Metamasks window.ethereum library
            async function connect() {
                if (window.ethereum) {
                    try {
                        const selectedAccount = await window.ethereum
                        .request({
                            method: "eth_requestAccounts",
                        })
                        .then((accounts) => accounts[0])
                        .catch(() => {
                            consoleOutput("No account selected!");
                            throw Error("No account selected!");
                        });
                        window.userAddress = selectedAccount;
                        window.localStorage.setItem("userAddress", selectedAccount);
                        consoleOutput(`☑ETH Address: ${truncateAddress(window.userAddress)}`);
                        document.getElementById('mint-button').innerHTML = '<b><i>Send Transaction!</i></b>';
                        load_ownedFrogs();
                    } catch (error) {
                        console.error(error);
                        consoleOutput(error);
                    }
                } else {
                    consoleOutput("No ETH brower extension detected.");
                }
            }
            function consoleOutput(output) {
                document.getElementById('minting-console').innerHTML = output;
            }


            // start here

            var frog_count;

            document.addEventListener("DOMContentLoaded", async () => {

                CONTRACT_ADDRESS = "0xBE4Bef8735107db540De269FF82c7dE9ef68C51b";

                var frog_count = 1;
              
                // Pull Collection data from OpenSea

                const options = {method: 'GET', headers: {'X-API-KEY': '1b80881e422a49d393113ede33c81211'}};

                fetch('https://api.opensea.io/api/v1/collection/fresh-frogs', options)
                .then(response => response.json())
                .then(response => {

                    console.log(response)

                    var { collection: { banner_image_url, created_date, description, dev_seller_fee_basis_points, external_url, featured_image_url, name, payout_address, stats: { floor_price, market_cap, total_volume, count, num_owners } } } = response

                    document.getElementById('banner_image').setAttribute('src', banner_image_url)
                    document.getElementById('name').innerHTML = name
                    document.getElementById('count').innerHTML = count
                    document.getElementById('num_owners').innerHTML = num_owners
                    document.getElementById('market_cap').innerHTML = market_cap.toFixed(2)+' Ξ'
                    document.getElementById('floor_price').innerHTML = floor_price+' Ξ'
                    document.getElementById('total_volume').innerHTML = total_volume.toFixed(2)+' Ξ'
                    document.getElementById('description').innerHTML = description
                    document.getElementById('created_date').innerHTML = created_date + ' - present <b>Recent Sales</b> limited 7'
                    //document.getElementById('payout_address').innerHTML = payout_address

                    var initial_sales = (parseInt(count) - 3240) * 0.01

                    //document.getElementById('initial_sales').innerHTML = (initial_sales+parseInt(total_volume.toFixed(2)))+' Ξ'

                })
                .catch(e => {

                    console.log('Error: Could not talk to OpenSea...');
                    console.error(e.message)
              
                }); // End data pull / first paid Frog 3,236

                // Get recent sales
              
                fetch('https://api.opensea.io/api/v1/events?collection_slug=fresh-frogs&event_type=successful&limit=7', options)
                .then(res => res.json())
                .then(res => {

                    var { asset_events } = res

                    //console.log(asset_events)
                    
                    var percent_width = 92 / 7 + '%'

                    asset_events.forEach((sale) => {
                      

                        try {

                            var { asset: { image_url, name, permalink }, payment_token: { decimals }, total_price } = sale;

                            var sale_price = total_price / Math.pow(10, decimals);

                            //console.log('Sale found...'+sale.asset.name+' : '+sale_price);

                            recent_sale = document.createElement('div');
                            recent_sale.className = 'recent_sale';
                            recent_sale.style.width = 128+64+'px';
                            recent_sale.href = permalink;
                            recent_sale.innerHTML = 
                                '<img class="frog_img" src='+image_url+'>' +
                                '<i class="label_name">Fresh Frogs NFT</i><i class="label_price">Price</i>' +
                                '<b class="frog_name">'+name+'</b><b class="frog_price">Ξ '+sale_price+'</b>';
                            document.getElementById('recent_sales').appendChild(recent_sale);
                      
                        } catch (e) { console.log(e.message) }

                    })


                })
                .catch(e => {

                    console.log('Error: Could not talk to OpenSea...');
                    console.error(e.message)

                })
                document.querySelector("#add-frog").addEventListener("click", async (e) => {

                    if (frog_count <= 1) {
                        document.getElementById('frog-tray-1').innerHTML = '';
                    } 
                    
                    frog_count = frog_count + 1

                    new_frog = document.createElement('img');
                    //new_frog.style.borderRadius = '5px'
                    new_frog.className = 'tray-frog'
                    new_frog.src = '../frog/'+frog_count+'.png'

                    document.getElementById('frog-tray-1').appendChild(new_frog);

                    all_frogs = document.getElementsByClassName('tray-frog');

                    for (var i = 0; i < all_frogs.length; i++) {
                        all_frogs[i].style.width = 100 / frog_count + '%';
                    }
                })
            })
        </script>
    </head>
    <header>
        <img class="banner_image" id="banner_image" src="../assets/frogs/backfrogs.png"/>
    </header>
    <body>
        <a href="https://opensea.io/collection/fresh-frogs" target="_blank"><h1 class="collection-name" id="name">Fresh Frogs NFT</h1></a>
        <p>Items: <b id="count"></b> | Owners: <b id="num_owners"></b> | Market Cap: <b id="market_cap"></b> | Floor Price: <b id="floor_price"></b> | Sales Volume: <b id="total_volume"></b> <b id="initial_sales"></b></p>
        <hr>
        <p><i id="created_date"></i></p>
        <div id="recent_sales" class="recent_sales"></div>
        {{ content }}
    <body>
    <footer></footer>
</html>