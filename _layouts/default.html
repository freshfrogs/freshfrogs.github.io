<!DOCTYPE html>
<style>
    .pointer {
        cursor: default;
    }
    .pointerOff {
        cursor: default;
    }
    .process {
      cursor: default;
    }
    .processImages{
      cursor: default;
    }
    .collection{
      cursor: default;
    }
    .collectionImg{
      cursor: default;
    }
</style>
<html lang="{{ site.lang | default: "en-US" }}">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="{{ "/assets/css/style.css?v=" | append: site.github.build_revision | relative_url }}">
    <!--[if lt IE 9]>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.min.js"></script>
    <![endif]-->

    <!-- ----------------------------------- Begin Script f0 / Call all web3 variables ------------------------------------ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/web3/1.7.0-rc.0/web3.min.js"></script>
    <script src="https://unpkg.com/f0js/dist/f0.js"></script>
    <script> // Script begins -- call variables and link web3
      const f0 = new F0();
      const web3 = new Web3(window.ethereum)
      // Load images inside <pre>

      //
      document.addEventListener("DOMContentLoaded", async () => {
        try {
          await f0.init({
            web3: web3,
            contract: "0x9500aEe4F34681D38D2f53C634b36b9CCc236d10",
            network: "rinkeby"
          })
          // connecting message
          document.getElementById("netStatus").innerHTML = "Please connect an Ethereum wallet... <b><i>connecting...</i></b>"

          var userAcc = web3.currentProvider.selectedAddress;
          var userAcc = userAcc.substring(0, 5)+"..."+userAcc.slice(-4);
          
          let nextId = await f0.api.nextId().call()
          let token = await f0.get(nextId);
          var remaining = 4040 - nextId;
          let estimateGas = await f0.mintCost(null, 1);

          console.log(estimateGas);
          console.log(token)

          // Update website layout with set variables
          document.getElementById("nextTokenImg").setAttribute("src", token.converted.image) // Set preview image to next token ID
          document.getElementById("nextToken").innerHTML = "<strong>FROG #"+nextId+"</strong>available mint" // Update next token ID
          document.getElementById("mintTransact").innerHTML = "<strong>MINT</strong>(transact)" // Update Mint button
          document.getElementById("mintTransact").removeAttribute("href") // Removes mint button link
          document.getElementById("netStatus").innerHTML = "Please connect an Ethereum wallet... <b><i>"+userAcc+" ✓</i></b>"
          document.getElementById("pre").innerHTML = document.getElementById("pre").innerHTML+"<b><strong>FROG #"+nextId+"</strong></b> is now available for mint... <a href=''><b>See Invites</b></a>"

          // Event listeners
          document.querySelector("#gasEst").addEventListener("click", async (e) => { // Gas estimate button
            document.querySelector("pre").innerHTML = document.getElementById("pre").innerHTML+"\nEstimated gas fees... <b>< "+Math.round(JSON.stringify(estimate.eth.safeLow, null, 1) * 1000) / 1000+" ΞEth ($"+Math.round(JSON.stringify(estimate.usd.safeLow, null, 1) * 100) / 100+")</b>"
          })
          document.querySelector("#mint").addEventListener("click", async (e) => { // Mint button
            document.getElementById("pre").innerHTML = document.getElementById("pre").innerHTML+"\nMinting <b>FROG #"+nextId+"</b>... please sign the transaction and wait...<br>"
            // Runs mint function through web3/f0
            let tokens = await f0.mint(null, 1)
            var openseaTest = tokens.map((token) => { // return opensea link for newly minted token
              return token.links.opensea
            })
            document.getElementById("pre").innerHTML = document.getElementById("pre").innerHTML+"<hr><h3 class='h3'>Congratulations!</h3>"+"<b>FROG #"+nextId+" </b>has successfully been minted! <a href='"+openseaTest+"'><b>View on Opensea</a></b><hr>"
          })
        } catch (e) { // Catch and return errors
          document.querySelector("pre").innerHTML = document.getElementById("pre").innerHTML+"\n<b>"+e.message+"! <a href='https://nf7uos.github.io/'>Refresh</a></b>" }
      })
    </script>
  </head>
  <body class="page-body"> <!-- Main Body -->
    <div class="wrapper">
      <header> <!-- Left Side Header / Opensea Link / Preview Image -->
        <img class="os pixelated pointer" src="openseaLogoW.png" href="https://testnets.opensea.io/collection/forestfrog2"><a href="https://testnets.opensea.io/collection/forestfrog2"><h2 class="h2">View Collection</h2></a>
        <img id="nextTokenImg" class="" src="/assets/preview.gif">
        <ul class="downloads">
            <li>
                <a id="totalValue" class="pointerOff"><strong>4,040</strong>frogs</a>
            </li>
            <li>
                <a id="gasEstimate" class="pointerOff"><strong>0.04 ΞEth</strong>plus gas</a>
            </li>
            <li>
                <a id="mintTransact" class="pointer" href="https://nf7uos.github.io/"><b><strike><strong>Mint</strong></strike></b>link wallet!</a>
            </li>
        </ul>
      </header>
      <section class="page-section"> <!-- Main Content Layout / Index.md -->
        {{ content }}
        <pre>
            <h3 class="h3">Minting Process</h3>
            <div class= "collection" id="collection"></div> <!-- Collection Images -->
            「 <b><a href='https://nf7uos.github.io/'>Link1</a></b> 」「 <b><a href='https://nf7uos.github.io/'>Link2</a></b> 」「 <b><a href='https://nf7uos.github.io/'>Link3</a></b> 」
            <hr><netStatus id="netStatus">
            Please connect an Ethereum wallet... <b><a href='https://nf7uos.github.io/'>Connect</a></b>
            Don't have a wallet?... <b><a href='https://metamask.io/download/'>Download MetaMask</a></b></netStatus>
        </pre>
      </section>
      <footer> <!-- Footer? -->
      </footer>
    </div>
    <script src="{{ "/assets/js/scale.fix.js" | relative_url }}"></script>
  </body>
</html>
